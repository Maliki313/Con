"""
Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ø­Ø³Ù† Ù…Ø¹ ØªÙƒØ§Ù…Ù„ OpenAI
Ø¥ØµØ¯Ø§Ø± Ù…Ø­Ø¯Ø« Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆØ¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
"""

import os
import sys
import logging
import time
from typing import Optional, Dict, Any
import telebot
from openai import OpenAI
from datetime import datetime
import json

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¬Ù„Ø§Øª
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log', encoding='utf-8'),
        logging.StreamHandler(sys.stdout)
    ]
)
logger = logging.getLogger(__name__)

class TelegramOpenAIBot:
    """Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ø­Ø³Ù† Ù…Ø¹ ØªÙƒØ§Ù…Ù„ OpenAI Assistant."""
    
    def __init__(self):
        """ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©."""
        # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©
        self.telegram_token = os.getenv('TELEGRAM_TOKEN')
        self.openai_api_key = os.getenv('OPENAI_API_KEY')
        self.assistant_id = os.getenv('ASSISTANT_ID')
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        self._validate_environment()
        
        # ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        try:
            self.bot = telebot.TeleBot(self.telegram_token)
            self.openai_client = OpenAI(api_key=self.openai_api_key)
            logger.info("ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙˆØª ÙˆØ¹Ù…ÙŠÙ„ OpenAI Ø¨Ù†Ø¬Ø§Ø­")
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: {e}")
            sys.exit(1)
        
        # Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        self.setup_handlers()
        
        # ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
        self.active_threads: Dict[int, str] = {}
        
        # Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        self.usage_stats = {
            'total_messages': 0,
            'successful_responses': 0,
            'errors': 0,
            'start_time': datetime.now()
        }
    
    def _validate_environment(self):
        """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©."""
        missing_vars = []
        
        if not self.telegram_token:
            missing_vars.append('TELEGRAM_TOKEN')
        if not self.openai_api_key:
            missing_vars.append('OPENAI_API_KEY')
        if not self.assistant_id:
            missing_vars.append('ASSISTANT_ID')
        
        if missing_vars:
            error_msg = f"Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©: {', '.join(missing_vars)}"
            logger.error(error_msg)
            sys.exit(1)
    
    def setup_handlers(self):
        """Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„."""
        
        @self.bot.message_handler(commands=['start'])
        def start_command(message):
            self.handle_start(message)
        
        @self.bot.message_handler(commands=['help'])
        def help_command(message):
            self.handle_help(message)
        
        @self.bot.message_handler(commands=['stats'])
        def stats_command(message):
            self.handle_stats(message)
        
        @self.bot.message_handler(commands=['reset'])
        def reset_command(message):
            self.handle_reset(message)
        
        @self.bot.message_handler(func=lambda message: True)
        def handle_all_messages(message):
            self.handle_message(message)
    
    def handle_start(self, message):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /start."""
        welcome_text = """
ğŸ¤– Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ!

Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…Ø¯Ø¹ÙˆÙ… Ø¨ØªÙ‚Ù†ÙŠØ© OpenAIØŒ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
â€¢ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
â€¢ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª
â€¢ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø´Ø±ÙˆØ­Ø§Øª
â€¢ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©

ğŸ“ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:
/help - Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
/stats - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
/reset - Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©

Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ³Ø£Ø¬ÙŠØ¨Ùƒ ÙÙˆØ±Ø§Ù‹!
        """
        try:
            self.bot.reply_to(message, welcome_text.strip())
            logger.info(f"Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {message.from_user.id}")
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨: {e}")
    
    def handle_help(self, message):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /help."""
        help_text = """
ğŸ“š Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ

ğŸ”§ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:
â€¢ /start - Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
â€¢ /help - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
â€¢ /stats - Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
â€¢ /reset - Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

ğŸ’¡ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
1. Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ
2. Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ
3. ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ

âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:
â€¢ Ø§Ù„Ø¨ÙˆØª ÙŠØ­ØªÙØ¸ Ø¨Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
â€¢ Ø§Ø³ØªØ®Ø¯Ù… /reset Ù„Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø£Ø³Ø¦Ù„ØªÙƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø¥Ø¬Ø§Ø¨Ø©

ğŸ”’ Ø§Ù„Ø®ØµÙˆØµÙŠØ©:
â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¢Ù…Ù†Ø© ÙˆÙ…Ø´ÙØ±Ø©
â€¢ Ù„Ø§ ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
        """
        try:
            self.bot.reply_to(message, help_text.strip())
            logger.info(f"Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {message.from_user.id}")
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©: {e}")
    
    def handle_stats(self, message):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /stats."""
        try:
            uptime = datetime.now() - self.usage_stats['start_time']
            success_rate = (self.usage_stats['successful_responses'] / 
                          max(1, self.usage_stats['total_messages'])) * 100
            
            stats_text = f"""
ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª

ğŸ“ˆ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: {self.usage_stats['total_messages']}
â€¢ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù†Ø§Ø¬Ø­Ø©: {self.usage_stats['successful_responses']}
â€¢ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: {self.usage_stats['errors']}
â€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: {success_rate:.1f}%

â° Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„:
â€¢ Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: {str(uptime).split('.')[0]}
â€¢ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©: {len(self.active_threads)}

ğŸ”§ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…: âœ… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ
            """
            self.bot.reply_to(message, stats_text.strip())
            logger.info(f"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {message.from_user.id}")
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: {e}")
            self.bot.reply_to(message, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª")
    
    def handle_reset(self, message):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /reset."""
        try:
            user_id = message.from_user.id
            if user_id in self.active_threads:
                del self.active_threads[user_id]
                self.bot.reply_to(message, "âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­!")
                logger.info(f"ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}")
            else:
                self.bot.reply_to(message, "â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù†Ø´Ø·Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡Ø§")
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: {e}")
            self.bot.reply_to(message, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©")
    
    def handle_message(self, message):
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ù…Ø¹ OpenAI Assistant."""
        user_id = message.from_user.id
        user_text = message.text
        
        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        self.usage_stats['total_messages'] += 1
        
        try:
            # Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            self.bot.send_chat_action(message.chat.id, 'typing')
            
            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯ Ù…Ù† OpenAI
            ai_response = self.get_ai_response(user_text, user_id)
            
            if ai_response:
                # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯
                self.bot.reply_to(message, ai_response)
                self.usage_stats['successful_responses'] += 1
                logger.info(f"Ø±Ø¯ Ù†Ø§Ø¬Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}")
            else:
                error_msg = "âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."
                self.bot.reply_to(message, error_msg)
                self.usage_stats['errors'] += 1
                
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}: {e}")
            error_msg = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹."
            try:
                self.bot.reply_to(message, error_msg)
            except:
                logger.error("ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£")
            self.usage_stats['errors'] += 1
    
    def get_ai_response(self, user_input: str, user_id: int) -> Optional[str]:
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯ Ù…Ù† OpenAI Assistant."""
        try:
            # Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… thread Ù…ÙˆØ¬ÙˆØ¯
            if user_id not in self.active_threads:
                thread = self.openai_client.beta.threads.create()
                self.active_threads[user_id] = thread.id
                logger.info(f"thread Ø¬Ø¯ÙŠØ¯ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}")
            
            thread_id = self.active_threads[user_id]
            
            # Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            self.openai_client.beta.threads.messages.create(
                thread_id=thread_id,
                role="user",
                content=user_input
            )
            
            # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
            run = self.openai_client.beta.threads.runs.create(
                thread_id=thread_id,
                assistant_id=self.assistant_id
            )
            
            # Ø§Ù†ØªØ¸Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„
            max_attempts = 30
            for _ in range(max_attempts):
                run_status = self.openai_client.beta.threads.runs.retrieve(
                    thread_id=thread_id,
                    run_id=run.id
                )
                
                if run_status.status == 'completed':
                    break
                elif run_status.status in ['failed', 'cancelled', 'expired']:
                    logger.error(f"ÙØ´Ù„ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯: {run_status.status}")
                    return None
                
                time.sleep(1)
            else:
                logger.error("Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯")
                return None
            
            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯
            messages = self.openai_client.beta.threads.messages.list(
                thread_id=thread_id,
                order="desc",
                limit=1
            )
            
            if messages.data:
                assistant_message = messages.data[0]
                if hasattr(assistant_message.content[0], 'text'):
                    return assistant_message.content[0].text.value
            
            logger.error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯")
            return None
            
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯ AI: {e}")
            return None
    
    def run(self):
        """ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª."""
        logger.info("ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª...")
        try:
            self.bot.infinity_polling(
                timeout=10,
                long_polling_timeout=5,
                none_stop=True,
                interval=1
            )
        except KeyboardInterrupt:
            logger.info("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª: {e}")
            sys.exit(1)

def main():
    """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©."""
    try:
        bot = TelegramOpenAIBot()
        bot.run()
    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()